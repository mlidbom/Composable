<!doctype html>
<html class="no-js" lang="en">
    <head>
    <!--foundation template lines-->
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/vendor/foundation-6.2.4-complete.zip/css/foundation.css">
    <!--End foundation template lines-->


    <link rel="stylesheet" href="/vendor-css/font-awesome-4.7.0.min.css">
    <link rel="stylesheet" href="/vendor-css/asciidoctor.css">
    <link rel="stylesheet" href="/vendor-css/asciidoc-pygments-manual.css">


    <meta name="description" content="A .Net toolkit making CQRS, Event Sourcing, Event Driven Architecture, VEST testing and DDD simpler and more productive.
">
    <link rel="stylesheet" href="/styles/app.css">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
</head>
<body>
    <div class="row">
        <div id="page-start-anchor" ></div>

        <div class="top-bar">
    <div class="top-bar-left">
        <ul class="dropdown menu" data-dropdown-menu>
            <li class="menu-text">Composable Toolkit</li>
            <li>
                <a href="/">Home</a>
            </li>
            <li>
                <a href="/documentation/">Documentation</a>
                <ul class="menu">
                    <li>
                        <a href="/documentation/">Written</a>
                    </li>
                    <li>
                        <a href="/apidoc/">API</a>
                        <ul class="menu">
                            <li><a href="/apidocs/3.4.6">Version 3.4.6</a></li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</div>


        
            <div class="large-3 large-push-9 columns page-toc" data-sticky-container>
    <nav data-sticky data-options="marginTop:4;stickyOn:large">
        <h4>TOC</h4>
        <ul class="sectlevel0">
<li><a href="#basic_concepts">Basic Concepts</a>
<ul class="sectlevel1">
<li><a href="#messaging">1. Messaging</a>
<ul class="sectlevel2">
<li><a href="#messaging_terms">1.1. Messaging terms</a></li>
<li><a href="#semantic_routing">1.2. Semantic Routing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#components_basics">Components Basics</a>
<ul class="sectlevel1">
<li><a href="#event_store_basics">2. Event Store Basics</a>
<ul class="sectlevel2">
<li><a href="#aggregate_roots">2.1. Aggregate Roots</a></li>
<li><a href="#the_event_store_session">2.2. The Event Store Session</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#components_advanced">Components Advanced</a>
<ul class="sectlevel1">
<li><a href="#refactoring_event_streams">3. Refactoring Event Streams</a></li>
</ul>
</li>
</ul>
    </nav>
</div>
        

        <div class="large-9 large-pull-3 columns asciidoc" role="content">
    <h1 id="basic_concepts" class="sect0">Basic Concepts</h1>
<div class="sect1">
<h2 id="messaging">1. Messaging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Any method call can, if you squint, be viewed as one object sending a message to another object object.
However, this ties the sender to the receiver in a very tight way.
Great benefits can be had by making the message passing explicit.
By sending messages to a receiver through some intermediary rather than directly.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Messaging is also known as message passing.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The code blocks in this section contain pseudo code for illustration purposes.
It is not compatible with any specific library including Composable.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="messaging_terms">1.1. Messaging terms</h3>
<div class="paragraph">
<p>Here we define some terms as they are used in the context of this document.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Message</dt>
<dd>
<p>An object for the purpose of sending data to a receiver.</p>
</dd>
<dt class="hdlist1">Message Type</dt>
<dd>
<p>The System.Type returned by <code>message.GetType()</code>.</p>
</dd>
<dt class="hdlist1">Message Handler</dt>
<dd>
<p>In principle just a function that takes a message as a parameter.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="csharp"><span class="tok-k">void</span> <span class="tok-nf">Handle</span><span class="tok-p">(</span><span class="tok-n">RegisterAccountCommand</span> <span class="tok-n">command</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In practice most message handlers need to have one or more dependencies injected into them.
In order to support this handlers are often required to be wrapped inside interfaces.
 That way instances of implementing classes can be resolved from an IOC container easily.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="csharp"><span class="tok-k">interface</span> <span class="tok-n">IMessageHandler</span><span class="tok-p">&lt;</span><span class="tok-n">RegisterAccountCommand</span><span class="tok-p">&gt;</span>
<span class="tok-p">{</span>
    <span class="tok-k">void</span> <span class="tok-nf">Handle</span><span class="tok-p">(</span><span class="tok-n">RegisterAccountCommand</span> <span class="tok-n">aMessage</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Routing</dt>
<dd>
<p>The mechanism by which messages are delivered to handlers.</p>
</dd>
<dt class="hdlist1">Service Bus</dt>
<dd>
<p>A component which decouples message senders from message handlers.
Instead of client code calling handler methods, clients send and receive messages via the bus.
The bus is responsible for routing the messages to the appropriate handler(s) and invoking them.</p>
<div class="listingblock">
<div class="title">Manual service invokation requires an instance of the service.</div>
<div class="content">
<pre class="pygments highlight"><code>serviceInstance.RegisterAccount(arguments....</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Client don&#8217;t even know where the service is when accessing it across a bus</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="csharp"><span class="tok-n">bus</span><span class="tok-p">.</span><span class="tok-n">Execute</span><span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-n">RegisterAccountCommand</span><span class="tok-p">(</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The benefits of this decoupling may not be obvious at first, but they are profound.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">Command</dt>
<dd>
<p>A message that instructs the handler to perform an action.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="csharp"><span class="tok-k">class</span> <span class="tok-nc">RegisterAccountCommand</span>
<span class="tok-p">{</span>
    <span class="tok-n">Password</span> <span class="tok-n">Password</span> <span class="tok-p">{</span> <span class="tok-k">get</span><span class="tok-p">;</span> <span class="tok-p">}</span>
    <span class="tok-n">Email</span> <span class="tok-n">Email</span> <span class="tok-p">{</span> <span class="tok-k">set</span><span class="tok-p">;</span> <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Event</dt>
<dd>
<p>A message that informs handlers about something that has happened.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="csharp"><span class="tok-k">interface</span> <span class="tok-n">IAccountRegisteredEvent</span>
<span class="tok-p">{</span>
    <span class="tok-n">Password</span> <span class="tok-n">Password</span> <span class="tok-p">{</span> <span class="tok-k">get</span><span class="tok-p">;</span> <span class="tok-p">}</span>
    <span class="tok-n">Email</span> <span class="tok-n">Email</span> <span class="tok-p">{</span> <span class="tok-k">get</span><span class="tok-p">;</span> <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Query</dt>
<dd>
<p>A message that asks the handler to supply some data.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="csharp"><span class="tok-k">class</span> <span class="tok-nc">RecentlyRegisteredAccountsQuery</span>
<span class="tok-p">{</span>
    <span class="tok-n">TimeSpan</span> <span class="tok-n">MaxAge</span> <span class="tok-p">{</span> <span class="tok-k">get</span><span class="tok-p">;</span> <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Command Handler</dt>
<dd>
<p>A message handler for a command. Must ensure that the command is successfully executed or throw an exception.</p>
</dd>
<dt class="hdlist1">Query Handler</dt>
<dd>
<p>A message handler for a query. Must ensure that the query is successfully executed or throw an exception.</p>
</dd>
<dt class="hdlist1">Event Handler</dt>
<dd>
<p>A message handler for an event.</p>
</dd>
<dt class="hdlist1">Event Listener</dt>
<dd>
<p>Same as Event Handler.</p>
</dd>
<dt class="hdlist1">Subscribe</dt>
<dd>
<p>The action of registering an Event Handler with a service bus.</p>
</dd>
<dt class="hdlist1">Subscriber</dt>
<dd>
<p>An event handler registered on a service bus.</p>
</dd>
<dt class="hdlist1">Sending a command or query</dt>
<dd>
<p>Asking a service bus to deliver a message to its handler.</p>
</dd>
<dt class="hdlist1">Publishing an event</dt>
<dd>
<p>Sending an event to all it&#8217;s subscribers.</p>
</dd>
<dt class="hdlist1">Raising an event</dt>
<dd>
<p>Same as Publishing an event</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You should never talk about sending events.
You always publish/Raise events.
Keeping Send separate from Publish in your mind is fundamental to understanding.
Trust us on this.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="semantic_routing">1.2. Semantic Routing</h3>
<div class="paragraph">
<p>Powerful, zero configuration, message type base routing.
Extremely loose coupling between event publishers and handlers.</p>
</div>
<div class="sect3">
<h4 id="definition">1.2.1. Definition</h4>
<div class="ulist">
<ul>
<li>
<p>Messages are delivered to every registered handler with a compatible argument type.</p>
</li>
<li>
<p>Commands and query message types must have exactly one handler.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Note that the first rule is really just standard polymorphism.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Semantic Routing is also known as "Polymorphic routing" or "Polymorphic  dispatching".
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="clarifying_examples">1.2.2. Clarifying examples</h4>
<div class="paragraph">
<p>While the rules might be simple their consequences can be anything but.
Let&#8217;s try some basic examples.</p>
</div>
<div class="listingblock">
<div class="title">Given these event interfaces and implementing classes</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="csharp"><span class="tok-k">interface</span> <span class="tok-n">IA</span>
<span class="tok-k">interface</span> <span class="tok-n">IB</span> <span class="tok-p">:</span> <span class="tok-n">IA</span>
<span class="tok-k">interface</span> <span class="tok-n">IC</span> <span class="tok-p">:</span> <span class="tok-n">IB</span>

<span class="tok-k">class</span> <span class="tok-nc">A</span> <span class="tok-p">:</span> <span class="tok-n">IA</span> <span class="tok-p">{}</span>
<span class="tok-k">class</span> <span class="tok-nc">B</span> <span class="tok-p">:</span> <span class="tok-n">IB</span> <span class="tok-p">{}</span>
<span class="tok-k">class</span> <span class="tok-nc">C</span> <span class="tok-p">:</span> <span class="tok-n">IC</span> <span class="tok-p">{}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">And these handler methods registered on our service bus</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="csharp"><span class="tok-k">void</span> <span class="tok-nf">HandleA</span><span class="tok-p">(</span><span class="tok-n">IAEvent</span> <span class="tok-c1">//Handles IA, IB and IC</span>
<span class="tok-k">void</span> <span class="tok-nf">HandleB</span><span class="tok-p">(</span><span class="tok-n">IBEvent</span> <span class="tok-c1">//Handles IB and IC</span>
<span class="tok-k">void</span> <span class="tok-nf">HandleC</span><span class="tok-p">(</span><span class="tok-n">IBEvent</span> <span class="tok-c1">//Handles only IC</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Let&#8217;s publish some events and examine the results.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="csharp"><span class="tok-n">serviceBus</span><span class="tok-p">.</span><span class="tok-n">Publish</span><span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-n">A</span><span class="tok-p">());</span> <span class="tok-c1">//Delivered to HandleA</span>
<span class="tok-n">serviceBus</span><span class="tok-p">.</span><span class="tok-n">Publish</span><span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-n">B</span><span class="tok-p">());</span> <span class="tok-c1">//Delivered to HandleA and HandleB</span>
<span class="tok-n">serviceBus</span><span class="tok-p">.</span><span class="tok-n">Publish</span><span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-n">C</span><span class="tok-p">());</span> <span class="tok-c1">//Delivered to HandleA, HandleB and HandleC</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="loose_coupling_through_interfaces">1.2.3. Loose coupling through interfaces</h4>
<div class="paragraph">
<p>Working with events in terms of interfaces give a great mount of flexibility.
Here is a partial list of things it is possible to do without having to change any code in any event listener.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Refactoring event classes</p>
</li>
<li>
<p>Adding event classes</p>
</li>
<li>
<p>Adding event interfaces</p>
</li>
<li>
<p>Changing event inheritance hierarchy</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The benefits of this are hard to overstate.
Make sure to remember to always think about events in terms of interfaces.
The event classes are an implementation detail that should only ever be known by the code that publishes the event.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Never subscribe to an event class</strong>. You will lose all the benefits just discussed.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<h1 id="components_basics" class="sect0">Components Basics</h1>
<div class="sect1">
<h2 id="event_store_basics">2. Event Store Basics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="aggregate_roots">2.1. Aggregate Roots</h3>

</div>
<div class="sect2">
<h3 id="the_event_store_session">2.2. The Event Store Session</h3>
<div class="sect3">
<h4 id="saving_and_loading_aggregate_roots">2.2.1. Saving and loading aggregate roots.</h4>

</div>
</div>
</div>
</div>
<h1 id="components_advanced" class="sect0">Components Advanced</h1>
<div class="sect1">
<h2 id="refactoring_event_streams">3. Refactoring Event Streams</h2>
<div class="sectionbody">

</div>
</div>
</div>
    </div>

    <footer class="row">
    <div class="large-12 columns">
        <hr>
        <div class="row">
            <div class="large-12 columns">

            </div>
        </div>
    </div>
</footer>

    <script src="/vendor/foundation-6.2.4-complete.zip/js/vendor/jquery.js"></script>
<script src="/vendor/foundation-6.2.4-complete.zip/js/vendor/what-input.js"></script>
<script src="/vendor/foundation-6.2.4-complete.zip/js/vendor/foundation.js"></script>
<script src="/js/app.js"></script>

</body>
</html>
